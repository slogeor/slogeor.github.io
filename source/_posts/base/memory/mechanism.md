---
title: JavaScript 内存机制
categories: base
tags: #文章標籤 可以省略
  - memory
---

### 基本概念

JavaScript的内存管理机制是: 内存基元在变量（对象，字符串等等）创建时分配，然后在他们不再被使用时`自动`释放，后者被称为垃圾回收。

### 内存模型

JS内存空间分为栈(stack)、堆(heap)、池(一般也会归类为栈中)。 其中栈存放变量，堆存放复杂对象，池存放常量。

**基础数据类型与栈内存**

基础数据类型有 Number String Null Undefined Boolean。

JS中的基础数据类型，这些值都有固定的大小，往往都保存在栈内存中（闭包除外），由系统自动分配存储空间。我们可以直接操作保存在栈内存空间的值，因此基础数据类型都是按值访问。

数据在栈内存中的存储与使用方式类似于数据结构中的堆栈数据结构，遵循后进先出的原则。

**引用数据类型与堆内存**

引用数据类型的值是保存在堆内存中的对象，JS不允许直接访问堆内存中的位置，因此我们不能直接操作对象的堆内存空间。

在操作对象时，实际上是在操作对象的引用而不是实际的对象。因此，引用类型的值都是按引用访问的。这里的引用，我们可以粗浅地理解为保存在栈内存中的一个地址，该地址与堆内存的实际值相关联。

堆存取数据的方式则与书架与书非常相似。 

当我们要访问堆内存中的引用数据类型时，实际上我们首先是从栈中获取了该对象的地址引用（或者地址指针），然后再从堆内存中取得我们需要的数据。

**复制行为**

基本数据类型的复制: 在栈内存中的数据发生复制行为时，系统会自动为新的变量分配一个新值，这两个值是相互独立互不影响。

引用类型的复制: 为新的变量自动分配一个新的值保存在栈内存中，这个新的值仅仅只是引用类型的一个地址指针。当地址指针相同时，尽管他们相互独立，但是在堆内存中访问到的具体对象实际上是同一个。

### 内存生命周期

- 1.内存分配：当我们申明变量、函数、对象的时候，系统会自动为他 们分配内存
- 2.内存使用：即读写内存，也就是使用变量、函数等
- 3.内存回收：使用完毕，由垃圾回收机制自动回收不再使用的内存

### 内存回收

**引用计数算法**

引用计数算法定义`内存不再使用`的标准很简单，就是看一个对象是否有指向它的引用。如果没有其他对象指向它了，说明该对象已经不再需了。

引用计数算法是个简单有效的算法。但它却存在一个致命的问题：循环引用。如果两个对象相互引用，尽管他们已不再使用，垃圾回收器不会进行回收，导致内存泄露。

**标记清除算法**

标记清除算法将`不再使用的对象`定义为`无法达到的对象`。简单来说，就是从根部（在JS中就是全局对象）出发定时扫描内存中的对象。凡是能从根部到达的对象，都是还需要使用的。那些无法由根部出发触及到的对象被标记为不再使用，稍后进行回收。

### 参考链接

[https://juejin.im/post/5b10ba336fb9a01e66164346](https://juejin.im/post/5b10ba336fb9a01e66164346)